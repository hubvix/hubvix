<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed de Videos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background-color: rgb(17, 24, 39);
            color: white;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 64px;
            background-color: black;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .logo {
            margin-bottom: 2rem;
        }

        .sidebar-button {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
        }

        .sidebar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Upload Button Styles */
        .upload-button {
            width: 100%;
            padding: 0.5rem;
            margin-top: auto;
            background-color: #ff3b5c;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
        }

        .upload-button:hover {
            background-color: #ff526e;
        }

        /* Upload Modal Styles */
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .upload-modal.active {
            display: flex;
        }

        .modal-content {
            background-color: rgb(31, 41, 55);
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            color: #9ca3af;
        }

        .form-input {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            background-color: #374151;
            color: white;
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        .submit-button {
            background-color: #ff3b5c;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
        }

        .submit-button:hover {
            background-color: #ff526e;
        }

        /* Video Container Styles */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: black;
        }

        /* Video Controls */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .control-button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
        }

        .progress-container {
            flex: 1;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background-color: #ff3b5c;
            border-radius: 2px;
            width: 0;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .volume-level {
            height: 100%;
            background-color: white;
            border-radius: 2px;
            transform-origin: left;
            transform: scaleX(1);
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .loading-indicator.active {
            display: block;
        }

        /* Button text display on larger screens */
        @media (min-width: 640px) {
            .sidebar {
                width: 256px;
            }

            .sidebar-button {
                justify-content: flex-start;
                padding-left: 1rem;
            }

            .button-text {
                display: inline;
                margin-left: 0.5rem;
            }

            .upload-button {
                justify-content: flex-start;
                padding-left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="currentColor">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 32.77c.07 4.28 1.43 7.54 5.26 9.32 2.91 1.35 6.38.61 9.34-.25l.72-.21c6.79-1.95 13.45-4.75 19.76-8.22 1.94-1.06 3.11-3.15 3.11-5.38V6.87a2.62 2.62 0 0 0-3.86-2.3c-5.33 2.94-11.07 4.71-17.06 5.23a2.62 2.62 0 0 0-2.42 2.61v9.89c-2.97-.11-5.94.49-8.66 1.78-2.94 1.39-4.36 3.99-5.19 7.11v1.58z"/>
                </svg>
            </div>
            <button class="sidebar-button">
                <i class="lucide-home"></i>
                <span class="button-text">Para ti</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-compass"></i>
                <span class="button-text">Explorar</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-user"></i>
                <span class="button-text">Siguiendo</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-video"></i>
                <span class="button-text">LIVE</span>
            </button>
            <button class="upload-button" id="uploadBtn">
                <i class="lucide-plus-circle"></i>
                <span class="button-text">Publicar</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="video-container" id="videoContainer">
                <video id="videoPlayer" autoplay muted></video>
                <div class="video-controls">
                    <button class="control-button" id="playPauseBtn">
                        <i class="lucide-play"></i>
                    </button>
                    <div class="volume-control">
                        <button class="control-button" id="muteBtn">
                            <i class="lucide-volume-2"></i>
                        </button>
                        <div class="volume-slider">
                            <div class="volume-level" id="volumeLevel"></div>
                        </div>
                    </div>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <button class="control-button" id="fullscreenBtn">
                        <i class="lucide-maximize"></i>
                    </button>
                </div>
                <div class="loading-indicator" id="loadingIndicator">
                    <i class="lucide-loader"></i>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div class="upload-modal" id="uploadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Publicar video</h2>
                    <button class="close-button" id="closeModal">&times;</button>
                </div>
                <form class="upload-form" id="uploadForm">
                    <div class="form-group">
                        <label class="form-label">Seleccionar video</label>
                        <input type="file" accept="video/*" class="form-input" id="videoInput" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-input" rows="3" placeholder="Describe tu video..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Etiquetas</label>
                        <input type="text" class="form-input" placeholder="#tendencias #viral">
                    </div>
                    <button type="submit" class="submit-button">Publicar</button>
                </form>
            </div>
        </div>
    </div>
<script>
    // DOM Elements
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadModal = document.getElementById('uploadModal');
    const closeModal = document.getElementById('closeModal');
    const uploadForm = document.getElementById('uploadForm');
    const videoInput = document.getElementById('videoInput');
    const videoContainer = document.getElementById('videoContainer');
    const videoPlayer = document.getElementById('videoPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const muteBtn = document.getElementById('muteBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const volumeLevel = document.getElementById('volumeLevel');
    
    // Validación de tipos de archivo permitidos
    const allowedTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    const maxFileSize = 100 * 1024 * 1024; // 100MB en bytes
    
    // Upload Modal Functionality
    uploadBtn.addEventListener('click', () => {
        uploadModal.classList.add('active');
    });
    
    closeModal.addEventListener('click', () => {
        uploadModal.classList.remove('active');
        resetUploadForm();
    });
    
    uploadModal.addEventListener('click', (e) => {
        if (e.target === uploadModal) {
            uploadModal.classList.remove('active');
            resetUploadForm();
        }
    });
    
    function resetUploadForm() {
        uploadForm.reset();
        const submitButton = uploadForm.querySelector('.submit-button');
        submitButton.textContent = 'Publicar';
        submitButton.disabled = false;
        if (videoPlayer.src) {
            URL.revokeObjectURL(videoPlayer.src);
            videoPlayer.src = '';
        }
    }
    
    // Mejorada la validación y manejo de archivos
    videoInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        const submitButton = uploadForm.querySelector('.submit-button');
        
        if (!file) {
            return;
        }
    
        // Validar tipo de archivo
        if (!allowedTypes.includes(file.type)) {
            alert('Por favor, sube solo archivos de video en formato MP4, WebM u OGG.');
            resetUploadForm();
            return;
        }
    
        // Validar tamaño
        if (file.size > maxFileSize) {
            alert('El archivo es demasiado grande. El tamaño máximo permitido es 100MB.');
            resetUploadForm();
            return;
        }
    
        try {
            // Crear URL temporal para previsualización
            const videoURL = URL.createObjectURL(file);
            videoPlayer.src = videoURL;
            
            // Esperar a que el video se pueda reproducir
            await videoPlayer.play();
            videoPlayer.pause();
            submitButton.disabled = false;
        } catch (error) {
            console.error('Error al cargar el video:', error);
            alert('Error al cargar el video. Por favor, intenta con otro archivo.');
            resetUploadForm();
        }
    });
    
    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitButton = uploadForm.querySelector('.submit-button');
        const file = videoInput.files[0];
    
        if (!file) {
            alert('Por favor, selecciona un video para subir.');
            return;
        }
    
        submitButton.textContent = 'Subiendo...';
        submitButton.disabled = true;
    
        try {
            // Aquí iría la lógica real de subida al servidor
            // Por ahora simulamos con un timeout
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            submitButton.textContent = '¡Publicado!';
            setTimeout(() => {
                uploadModal.classList.remove('active');
                resetUploadForm();
            }, 1500);
        } catch (error) {
            console.error('Error al subir el video:', error);
            alert('Error al subir el video. Por favor, intenta nuevamente.');
            submitButton.textContent = 'Publicar';
            submitButton.disabled = false;
        }
    });
    
    // Video Player Functionality con manejo mejorado de errores
    function togglePlay() {
        if (!videoPlayer.src) {
            return;
        }
    
        if (videoPlayer.paused) {
            videoPlayer.play()
                .then(() => {
                    playPauseBtn.innerHTML = '<i class="lucide-pause"></i>';
                })
                .catch(error => {
                    console.error('Error al reproducir:', error);
                    alert('Error al reproducir el video.');
                });
        } else {
            videoPlayer.pause();
            playPauseBtn.innerHTML = '<i class="lucide-play"></i>';
        }
    }
    
    videoContainer.addEventListener('click', (e) => {
        if (!e.target.closest('.video-controls')) {
            togglePlay();
        }
    });
    
    playPauseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        togglePlay();
    });
    
    let lastVolume = 1;
    function toggleMute() {
        if (!videoPlayer.src) {
            return;
        }
    
        if (videoPlayer.muted) {
            videoPlayer.muted = false;
            videoPlayer.volume = lastVolume;
            muteBtn.innerHTML = '<i class="lucide-volume-2"></i>';
            volumeLevel.style.transform = `scaleX(${lastVolume})`;
        } else {
            lastVolume = videoPlayer.volume;
            videoPlayer.muted = true;
            videoPlayer.volume = 0;
            muteBtn.innerHTML = '<i class="lucide-volume-x"></i>';
            volumeLevel.style.transform = 'scaleX(0)';
        }
    }
    
    muteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMute();
    });
    
    function toggleFullscreen() {
        if (!videoPlayer.src) {
            return;
        }
    
        if (!document.fullscreenElement) {
            videoContainer.requestFullscreen()
                .catch(error => {
                    console.error('Error al entrar en pantalla completa:', error);
                });
            fullscreenBtn.innerHTML = '<i class="lucide-minimize"></i>';
        } else {
            document.exitFullscreen()
                .catch(error => {
                    console.error('Error al salir de pantalla completa:', error);
                });
            fullscreenBtn.innerHTML = '<i class="lucide-maximize"></i>';
        }
    }
    
    fullscreenBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleFullscreen();
    });
    
    // Progress bar functionality mejorada
    videoPlayer.addEventListener('timeupdate', () => {
        if (!isNaN(videoPlayer.duration) && videoPlayer.duration > 0) {
            const percentage = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = `${percentage}%`;
        }
    });
    
    progressContainer.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!videoPlayer.src || isNaN(videoPlayer.duration)) {
            return;
        }
    
        const rect = progressContainer.getBoundingClientRect();
        const percentage = (e.clientX - rect.left) / rect.width;
        videoPlayer.currentTime = percentage * videoPlayer.duration;
    });
    
    // Volume control mejorado
    const volumeSlider = document.querySelector('.volume-slider');
    volumeSlider.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!videoPlayer.src) {
            return;
        }
    
        const rect = volumeSlider.getBoundingClientRect();
        const volume = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
        videoPlayer.volume = volume;
        volumeLevel.style.transform = `scaleX(${volume})`;
        
        if (volume === 0) {
            videoPlayer.muted = true;
            muteBtn.innerHTML = '<i class="lucide-volume-x"></i>';
        } else {
            videoPlayer.muted = false;
            lastVolume = volume;
            muteBtn.innerHTML = '<i class="lucide-volume-2"></i>';
        }
    });
    
    // Event Listeners mejorados
    videoPlayer.addEventListener('waiting', () => {
        loadingIndicator.classList.add('active');
    });
    
    videoPlayer.addEventListener('canplay', () => {
        loadingIndicator.classList.remove('active');
    });
    
    videoPlayer.addEventListener('playing', () => {
        loadingIndicator.classList.remove('active');
        playPauseBtn.innerHTML = '<i class="lucide-pause"></i>';
    });
    
    videoPlayer.addEventListener('pause', () => {
        playPauseBtn.innerHTML = '<i class="lucide-play"></i>';
    });
    
    videoPlayer.addEventListener('ended', resetVideoState);
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
    
        switch (e.code) {
            case 'Space':
                e.preventDefault();
                togglePlay();
                break;
            case 'KeyM':
                e.preventDefault();
                toggleMute();
                break;
            case 'KeyF':
                e.preventDefault();
                toggleFullscreen();
                break;
        }
    });
    
    // Video state management
    function resetVideoState() {
        if (!videoPlayer.src) {
            return;
        }
        
        videoPlayer.currentTime = 0;
        videoPlayer.pause();
        progressBar.style.width = '0%';
        playPauseBtn.innerHTML = '<i class="lucide-play"></i>';
    }
    
    // Cleanup
    window.addEventListener('beforeunload', () => {
        if (videoPlayer.src) {
            URL.revokeObjectURL(videoPlayer.src);
        }
    });
    
    // Error handling mejorado
    videoPlayer.addEventListener('error', () => {
        loadingIndicator.classList.remove('active');
        console.error('Error en el video:', videoPlayer.error);
        alert('Error al reproducir el video. Por favor, intenta con otro archivo.');
        resetVideoState();
    });
    
    // Initialize volume display
    volumeLevel.style.transform = `scaleX(${videoPlayer.volume})`;
</script>
</body>
</html>
