<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed de Videos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background-color: rgb(17, 24, 39);
            color: white;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 64px;
            background-color: black;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .logo {
            margin-bottom: 2rem;
        }

        .sidebar-button {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
        }

        .sidebar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Upload Button Styles */
        .upload-button {
            width: 100%;
            padding: 0.5rem;
            margin-top: auto;
            background-color: #ff3b5c;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
        }

        .upload-button:hover {
            background-color: #ff526e;
        }

        /* Upload Modal Styles */
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .upload-modal.active {
            display: flex;
        }

        .modal-content {
            background-color: rgb(31, 41, 55);
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            color: #9ca3af;
        }

        .form-input {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            background-color: #374151;
            color: white;
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        .submit-button {
            background-color: #ff3b5c;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
        }

        .submit-button:hover {
            background-color: #ff526e;
        }

        /* Video Container Styles */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: black;
        }

        /* Video Controls */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .control-button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
        }

        .progress-container {
            flex: 1;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background-color: #ff3b5c;
            border-radius: 2px;
            width: 0;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .volume-level {
            height: 100%;
            background-color: white;
            border-radius: 2px;
            transform-origin: left;
            transform: scaleX(1);
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .loading-indicator.active {
            display: block;
        }

        /* Button text display on larger screens */
        @media (min-width: 640px) {
            .sidebar {
                width: 256px;
            }

            .sidebar-button {
                justify-content: flex-start;
                padding-left: 1rem;
            }

            .button-text {
                display: inline;
                margin-left: 0.5rem;
            }

            .upload-button {
                justify-content: flex-start;
                padding-left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="currentColor">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 32.77c.07 4.28 1.43 7.54 5.26 9.32 2.91 1.35 6.38.61 9.34-.25l.72-.21c6.79-1.95 13.45-4.75 19.76-8.22 1.94-1.06 3.11-3.15 3.11-5.38V6.87a2.62 2.62 0 0 0-3.86-2.3c-5.33 2.94-11.07 4.71-17.06 5.23a2.62 2.62 0 0 0-2.42 2.61v9.89c-2.97-.11-5.94.49-8.66 1.78-2.94 1.39-4.36 3.99-5.19 7.11v1.58z"/>
                </svg>
            </div>
            <button class="sidebar-button">
                <i class="lucide-home"></i>
                <span class="button-text">Para ti</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-compass"></i>
                <span class="button-text">Explorar</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-user"></i>
                <span class="button-text">Siguiendo</span>
            </button>
            <button class="sidebar-button">
                <i class="lucide-video"></i>
                <span class="button-text">LIVE</span>
            </button>
            <button class="upload-button" id="uploadBtn">
                <i class="lucide-plus-circle"></i>
                <span class="button-text">Publicar</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="video-container" id="videoContainer">
                <video id="videoPlayer" autoplay muted></video>
                <div class="video-controls">
                    <button class="control-button" id="playPauseBtn">
                        <i class="lucide-play"></i>
                    </button>
                    <div class="volume-control">
                        <button class="control-button" id="muteBtn">
                            <i class="lucide-volume-2"></i>
                        </button>
                        <div class="volume-slider">
                            <div class="volume-level" id="volumeLevel"></div>
                        </div>
                    </div>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <button class="control-button" id="fullscreenBtn">
                        <i class="lucide-maximize"></i>
                    </button>
                </div>
                <div class="loading-indicator" id="loadingIndicator">
                    <i class="lucide-loader"></i>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div class="upload-modal" id="uploadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Publicar video</h2>
                    <button class="close-button" id="closeModal">&times;</button>
                </div>
                <form class="upload-form" id="uploadForm">
                    <div class="form-group">
                        <label class="form-label">Seleccionar video</label>
                        <input type="file" accept="video/*" class="form-input" id="videoInput" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-input" rows="3" placeholder="Describe tu video..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Etiquetas</label>
                        <input type="text" class="form-input" placeholder="#tendencias #viral">
                    </div>
                    <button type="submit" class="submit-button">Publicar</button>
                </form>
            </div>
        </div>
    </div>
<script>
 // DOM Elements - Agregamos verificación de existencia de elementos
const elements = {
    uploadBtn: 'uploadBtn',
    uploadModal: 'uploadModal',
    closeModal: 'closeModal',
    uploadForm: 'uploadForm',
    videoInput: 'videoInput',
    videoContainer: 'videoContainer',
    videoPlayer: 'videoPlayer',
    playPauseBtn: 'playPauseBtn',
    muteBtn: 'muteBtn',
    fullscreenBtn: 'fullscreenBtn',
    progressContainer: 'progressContainer',
    progressBar: 'progressBar',
    loadingIndicator: 'loadingIndicator',
    volumeLevel: 'volumeLevel'
};

// Verificación de elementos DOM
const domElements = {};
let hasError = false;

for (const [key, id] of Object.entries(elements)) {
    const element = document.getElementById(id);
    if (!element) {
        console.error(`Error: No se encontró el elemento con id "${id}"`);
        hasError = true;
    }
    domElements[key] = element;
}

if (hasError) {
    throw new Error('Faltan elementos DOM necesarios. Revisa la consola para más detalles.');
}

// Destructuring de elementos DOM verificados
const {
    uploadBtn,
    uploadModal,
    closeModal,
    uploadForm,
    videoInput,
    videoContainer,
    videoPlayer,
    playPauseBtn,
    muteBtn,
    fullscreenBtn,
    progressContainer,
    progressBar,
    loadingIndicator,
    volumeLevel
} = domElements;

// Constantes y configuración
const CONFIG = Object.freeze({
    allowedTypes: ['video/mp4', 'video/webm', 'video/ogg'],
    maxFileSize: 100 * 1024 * 1024, // 100MB en bytes
    uploadTimeout: 2000,
    successMessageDuration: 1500,
    icons: {
        play: '<i class="lucide-play"></i>',
        pause: '<i class="lucide-pause"></i>',
        volumeOn: '<i class="lucide-volume-2"></i>',
        volumeOff: '<i class="lucide-volume-x"></i>',
        maximize: '<i class="lucide-maximize"></i>',
        minimize: '<i class="lucide-minimize"></i>'
    }
});

// Estado global del reproductor
const playerState = {
    lastVolume: 1,
    isUploading: false
};

// Manejo de errores mejorado
class VideoPlayerError extends Error {
    constructor(message, type) {
        super(message);
        this.name = 'VideoPlayerError';
        this.type = type;
    }
}

function handleError(error, userMessage) {
    console.error(`${error.name}: ${error.message}`);
    if (userMessage) {
        alert(userMessage);
    }
}

// Upload Modal Functionality
function initializeUploadModal() {
    uploadBtn.addEventListener('click', () => {
        if (!playerState.isUploading) {
            uploadModal.classList.add('active');
        }
    });

    closeModal.addEventListener('click', () => {
        uploadModal.classList.remove('active');
        resetUploadForm();
    });

    uploadModal.addEventListener('click', (e) => {
        if (e.target === uploadModal) {
            uploadModal.classList.remove('active');
            resetUploadForm();
        }
    });
}

function resetUploadForm() {
    try {
        uploadForm.reset();
        const submitButton = uploadForm.querySelector('.submit-button');
        if (submitButton) {
            submitButton.textContent = 'Publicar';
            submitButton.disabled = false;
        }
        if (videoPlayer.src) {
            URL.revokeObjectURL(videoPlayer.src);
            videoPlayer.src = '';
        }
        playerState.isUploading = false;
    } catch (error) {
        handleError(error, 'Error al restablecer el formulario');
    }
}

// Validación de archivos mejorada
async function validateVideoFile(file) {
    if (!file) {
        throw new VideoPlayerError('No se seleccionó ningún archivo', 'validation');
    }

    if (!CONFIG.allowedTypes.includes(file.type)) {
        throw new VideoPlayerError(
            'Tipo de archivo no permitido',
            'validation'
        );
    }

    if (file.size > CONFIG.maxFileSize) {
        throw new VideoPlayerError(
            'Archivo demasiado grande',
            'validation'
        );
    }

    return true;
}

// Manejo de archivos mejorado
async function handleFileSelect(e) {
    const file = e.target.files[0];
    const submitButton = uploadForm.querySelector('.submit-button');

    try {
        await validateVideoFile(file);
        const videoURL = URL.createObjectURL(file);
        videoPlayer.src = videoURL;

        // Verificar que el video se puede reproducir
        await new Promise((resolve, reject) => {
            videoPlayer.addEventListener('loadedmetadata', resolve, { once: true });
            videoPlayer.addEventListener('error', reject, { once: true });
        });

        await videoPlayer.play();
        videoPlayer.pause();
        if (submitButton) submitButton.disabled = false;
    } catch (error) {
        handleError(
            error,
            'Error al cargar el video. Por favor, verifica el archivo e intenta nuevamente.'
        );
        resetUploadForm();
    }
}

// Manejo del formulario mejorado
async function handleFormSubmit(e) {
    e.preventDefault();
    
    if (playerState.isUploading) return;
    
    const submitButton = uploadForm.querySelector('.submit-button');
    const file = videoInput.files[0];

    try {
        await validateVideoFile(file);
        
        playerState.isUploading = true;
        if (submitButton) {
            submitButton.textContent = 'Subiendo...';
            submitButton.disabled = true;
        }

        // Simulación de subida
        await new Promise(resolve => setTimeout(resolve, CONFIG.uploadTimeout));
        
        if (submitButton) submitButton.textContent = '¡Publicado!';
        
        setTimeout(() => {
            uploadModal.classList.remove('active');
            resetUploadForm();
        }, CONFIG.successMessageDuration);
    } catch (error) {
        handleError(error, 'Error al subir el video. Por favor, intenta nuevamente.');
        if (submitButton) {
            submitButton.textContent = 'Publicar';
            submitButton.disabled = false;
        }
        playerState.isUploading = false;
    }
}

// Funciones del reproductor mejoradas
async function togglePlay() {
    if (!videoPlayer.src) return;

    try {
        if (videoPlayer.paused) {
            await videoPlayer.play();
            playPauseBtn.innerHTML = CONFIG.icons.pause;
        } else {
            videoPlayer.pause();
            playPauseBtn.innerHTML = CONFIG.icons.play;
        }
    } catch (error) {
        handleError(error, 'Error al reproducir el video');
    }
}

function toggleMute() {
    if (!videoPlayer.src) return;

    try {
        if (videoPlayer.muted) {
            videoPlayer.muted = false;
            videoPlayer.volume = playerState.lastVolume;
            muteBtn.innerHTML = CONFIG.icons.volumeOn;
            volumeLevel.style.transform = `scaleX(${playerState.lastVolume})`;
        } else {
            playerState.lastVolume = videoPlayer.volume;
            videoPlayer.muted = true;
            videoPlayer.volume = 0;
            muteBtn.innerHTML = CONFIG.icons.volumeOff;
            volumeLevel.style.transform = 'scaleX(0)';
        }
    } catch (error) {
        handleError(error, 'Error al cambiar el estado del audio');
    }
}

async function toggleFullscreen() {
    if (!videoPlayer.src) return;

    try {
        if (!document.fullscreenElement) {
            await videoContainer.requestFullscreen();
            fullscreenBtn.innerHTML = CONFIG.icons.minimize;
        } else {
            await document.exitFullscreen();
            fullscreenBtn.innerHTML = CONFIG.icons.maximize;
        }
    } catch (error) {
        handleError(error, 'Error al cambiar el modo de pantalla');
    }
}

// Inicialización y event listeners
function initializePlayer() {
    // Upload handlers
    initializeUploadModal();
    videoInput.addEventListener('change', handleFileSelect);
    uploadForm.addEventListener('submit', handleFormSubmit);

    // Video player handlers
    videoContainer.addEventListener('click', (e) => {
        if (!e.target.closest('.video-controls')) {
            togglePlay();
        }
    });

    playPauseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        togglePlay();
    });

    muteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMute();
    });

    fullscreenBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleFullscreen();
    });

    // Progress bar
    videoPlayer.addEventListener('timeupdate', () => {
        if (!isNaN(videoPlayer.duration) && videoPlayer.duration > 0) {
            const percentage = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = `${percentage}%`;
        }
    });

    progressContainer.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!videoPlayer.src || isNaN(videoPlayer.duration)) return;

        const rect = progressContainer.getBoundingClientRect();
        const percentage = (e.clientX - rect.left) / rect.width;
        videoPlayer.currentTime = percentage * videoPlayer.duration;
    });

    // Volume control
    const volumeSlider = document.querySelector('.volume-slider');
    if (volumeSlider) {
        volumeSlider.addEventListener('click', (e) => {
            e.stopPropagation();
            if (!videoPlayer.src) return;

            const rect = volumeSlider.getBoundingClientRect();
            const volume = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            videoPlayer.volume = volume;
            volumeLevel.style.transform = `scaleX(${volume})`;
            
            if (volume === 0) {
                videoPlayer.muted = true;
                muteBtn.innerHTML = CONFIG.icons.volumeOff;
            } else {
                videoPlayer.muted = false;
                playerState.lastVolume = volume;
                muteBtn.innerHTML = CONFIG.icons.volumeOn;
            }
        });
    }

    // Video state events
    videoPlayer.addEventListener('waiting', () => loadingIndicator.classList.add('active'));
    videoPlayer.addEventListener('canplay', () => loadingIndicator.classList.remove('active'));
    videoPlayer.addEventListener('playing', () => {
        loadingIndicator.classList.remove('active');
        playPauseBtn.innerHTML = CONFIG.icons.pause;
    });
    videoPlayer.addEventListener('pause', () => {
        playPauseBtn.innerHTML = CONFIG.icons.play;
    });
    videoPlayer.addEventListener('ended', resetVideoState);

    // Error handling
    videoPlayer.addEventListener('error', () => {
        loadingIndicator.classList.remove('active');
        handleError(
            new VideoPlayerError('Error en la reproducción del video', 'playback'),
            'Error al reproducir el video. Por favor, intenta con otro archivo.'
        );
        resetVideoState();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        switch (e.code) {
            case 'Space':
                e.preventDefault();
                togglePlay();
                break;
            case 'KeyM':
                e.preventDefault();
                toggleMute();
                break;
            case 'KeyF':
                e.preventDefault();
                toggleFullscreen();
                break;
        }
    });

    // Cleanup
    window.addEventListener('beforeunload', () => {
        if (videoPlayer.src) {
            URL.revokeObjectURL(videoPlayer.src);
        }
    });

    // Initialize volume display
    volumeLevel.style.transform = `scaleX(${videoPlayer.volume})`;
}

// Iniciar el reproductor cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', initializePlayer);
</script>
</body>
</html>
